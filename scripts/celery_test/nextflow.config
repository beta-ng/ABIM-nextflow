// File: nextflow.config (Corrected)
workDir = '/work'

profiles {

    k8s {
        process.executor = 'k8s'
        
        k8s {
            namespace = 'abim'
            storageClaimName = System.getenv('K8S_PVC_NAME') ?: 'nextflow-work-pvc'
            storageMountPath = '/work'
            
            pod = [
                env: [
                    [ name: 'AWS_ACCESS_KEY_ID', valueFrom: [ secretKeyRef: [ name: "abim-flow-run-${params.run_id}-s3-creds", key: 'AWS_ACCESS_KEY_ID' ] ] ],
                    [ name: 'AWS_SECRET_ACCESS_KEY', valueFrom: [ secretKeyRef: [ name: "abim-flow-run-${params.run_id}-s3-creds", key: 'AWS_SECRET_ACCESS_KEY' ] ] ]
                ]
            ]
        }

        aws {
            region = 'us-east-1'
        }
    }

    local {
        process.executor = 'local'
    }
}

params.run_id = null